# Блог приложение - Backend

RESTful backend для блог-приложения, построенный на Spring MVC, Spring JDBC и PostgreSQL.

## Возможности

- **Управление постами**
  - Создание, чтение, обновление и удаление постов
  - Пагинация и поиск постов
  - Поиск по названию или тегам
  - Функция лайков для постов
  - Автоматический подсчет количества комментариев

- **Система комментариев**
  - Добавление комментариев к постам
  - Обновление и удаление комментариев
  - Каскадное удаление при удалении поста

- **Система тегов**
  - Добавление нескольких тегов к постам
  - Поиск постов по тегам (один или несколько с логикой AND)
  - Регистронезависимое сопоставление тегов
  - Автоматическая нормализация тегов

- **Работа с изображениями**
  - Загрузка изображений для постов
  - Обновление существующих изображений
  - Скачивание изображений постов
  - Поддержка multipart/form-data

## Стек технологий

- **Фреймворк**: Spring MVC 6.2.14
- **База данных**: PostgreSQL 16 (продакшн), H2 2.3.232 (тестирование)
- **Java**: 21
- **Система сборки**: Gradle (Kotlin DSL)
- **Тестирование**: JUnit 5, Spring Test, MockMvc
- **JSON**: Jackson с JavaTimeModule
- **Сервер**: Apache Tomcat (развертывание через WAR)

## Требования

- Java 21 или выше
- Docker и Docker Compose (для PostgreSQL)
- Gradle 8.x (или используйте включенный wrapper)

## Начало работы

### 1. Запуск базы данных PostgreSQL

Используя Docker Compose:

```bash
cd docker
docker compose up -d
```

Это выполнит:
- Запуск PostgreSQL 16 на порту 5432
- Создание базы данных `blogdb`
- Автоматическое выполнение скриптов инициализации схемы
- Загрузку тестовых данных для разработки

### 2. Сборка приложения

```bash
./gradlew clean build
```

### 3. Запуск тестов

```bash
./gradlew test
```

Все тесты используют встроенную базу данных H2 и не требуют запущенного PostgreSQL.

**Результаты тестов**: 98 пройденных тестов (100% успешных)

### 4. Развертывание в Tomcat

Приложение собирается как WAR файл для развертывания в Tomcat:

```bash
./gradlew war
```

WAR файл будет создан в: `build/libs/my-blog-back-app-1.0-SNAPSHOT.war`

Скопируйте этот WAR файл в директорию `webapps` вашего Tomcat сервера.

### 5. Доступ к приложению

После развертывания API будет доступно по адресу:
```
http://localhost:8080/my-blog-back-app/api/
```

## API эндпоинты

### Посты

- `GET /api/posts` - Получить все посты (с пагинацией и поиском)
  - Параметры запроса: `page`, `size`, `search`
  - Формат поиска: `термины заголовка #тег1 #тег2`
- `GET /api/posts/{id}` - Получить пост по ID
- `POST /api/posts` - Создать новый пост
- `PUT /api/posts/{id}` - Обновить пост
- `DELETE /api/posts/{id}` - Удалить пост
- `POST /api/posts/{id}/likes` - Добавить лайк к посту

### Комментарии

- `GET /api/posts/{postId}/comments` - Получить все комментарии к посту
- `GET /api/posts/{postId}/comments/{id}` - Получить комментарий по ID
- `POST /api/posts/{postId}/comments` - Создать новый комментарий
- `PUT /api/posts/{postId}/comments/{id}` - Обновить комментарий
- `DELETE /api/posts/{postId}/comments/{id}` - Удалить комментарий

### Изображения

- `PUT /api/posts/{postId}/image` - Загрузить/обновить изображение для поста
  - Content-Type: `multipart/form-data`
  - Параметр: `image` (файл изображения)
- `GET /api/posts/{postId}/image` - Скачать изображение поста
